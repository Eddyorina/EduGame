<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Catalog</title>
	<link rel="stylesheet" href="dependencies/bootstrap.min.css">
	<script src="dependencies/react.min.js"></script>
	<script src="dependencies/react-dom.min.js"></script>
	<script src="dependencies/babel.min.js"></script>
	<!-- <link rel="stylesheet" type="text/css" href="home.css"> -->
	<!-- <link rel="stylesheet" type="text/css" href="catalog.css"> -->
</head>
<body>
	
	<nav class="navbar navbar-dark bg-dark navbar-expand-lg m-b-30" style="margin-bottom: 30px;">
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#subjectsToggler" aria-controls="subjectsToggler" aria-expanded="false" aria-label="Show Subjects">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div id="subjectsToggler" class="collapse">
			<div class="bg-secondary" style="height: 170px;">

			</div>
		</div>
		<a class="navbar-brand heading" style="font-size: 25px;" href="#">EduGame</a>
		<div class="collapse navbar-collapse justify-content-end mr-3" id="navbarNavDropdown">
			<ul class="navbar-nav">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle active" href="#" id="userMenuDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						User's name
					</a>
					<div class="dropdown-menu" aria-labelledby="userMenuDropdown">
						<button class="dropdown-item" id="logout" href="#">Log out</button>
					</div>
				</li>
			</ul>
		</div>
		<div>
			<form class="form-inline my-2 my-lg-0">
				<input class="form-control mr-sm-2" type="search" placeholder="eg. Math or Ice Commando" aria-label="Search">
				<button class="btn btn-primary my-2 my-sm-0" type="submit">Search</button>
			</form>
		</div>
	</nav>
	

	<div class="container font-weight-bold">New Games</div>
	<div id="newGames" class="h-20" style="margin-bottom: 70px">
	</div>
	<hr style="background-color: #aaacaf">

	<!-- <div class="container font-weight-bold">Other Games</div> -->
	<div id="games" style="margin-top: 70px"></div>

	<!-- <div id="blue">
	<div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
		<div class="container carousel-inner">
			
			<a class="carousel-item" href="#">las;kfj;lakfj;lkfj;ksadjf;ljkf</a>
			<div class="carousel-item active">
				<div class="row">
					<div class="col-lg-2">
						<div class="card">
							<img class="card-img-top" src="http://i.imgur.com/EW5FgJM.png" alt="Card image cap">
							<div class="card-body">
								<div class="card-title">Johntez</div>
								<div class="card-text">Lalalaland</div>
							</div>
						</div>
					</div>
					<div class="col-lg-2">
						<div class="card">
							<img class="card-img-top" src="http://i.imgur.com/EW5FgJM.png" alt="Card image cap">
							<div class="card-body">
								<div class="card-title">
									Johntez
								</div>
							</div>
						</div>
					</div>
					<div class="col">Peter</div>
				</div>
			</div>
			<div class="carousel-item">
				<div class="row">
					<div class="col-lg-2">
						<div class="card">
							<img class="card-img-top" src="http://i.imgur.com/EW5FgJM.png" alt="Card image cap">
							<div class="card-body">
								<div class="card-title">Johntez</div>
								<div class="card-text">Lalalaland</div>
							</div>
						</div>
					</div>
					<div class="col-lg-2">
						<div class="card">
							<img class="card-img-top" src="http://i.imgur.com/EW5FgJM.png" alt="Card image cap">
							<div class="card-body">
								<div class="card-title">
									Johntez
								</div>
							</div>
						</div>
					</div>
					<div class="col">Peter</div>
				</div>
			</div>
			<div class="carousel-item">
				<img class="d-block w-100" src="..." alt="Second slide">
			</div>
			<div class="carousel-item">
				<img class="d-block w-100" src="..." alt="Third slide">
			</div>
		</div>
	</div>
</div>
 -->
	<script src="jquery-3.3.1.js"></script>
	<script src="dependencies/popper.min.js"></script>
	<script src="dependencies/bootstrap.min.js"></script>
	<script src="jquery-validation-1.17.0/dist/jquery.validate.min.js"></script>
	<script type="text/javascript">
		var email = localStorage.getItem("useremail");
		var firstname = localStorage.getItem("firstname");
		var lastname = localStorage.getItem("lastname");

		var games;

		$("#userMenuDropdown").text(firstname + " " + lastname);

		$("#logout").on("click", () => {
			localStorage.clear();
			window.location.replace("login.html");
		})

		console.log(localStorage.getItem("privilege"));

	</script>
	<script type="text/babel">

		var promise = new Promise((resolve, reject) => {
			$.ajax({
				url: "server/CatalogUtility.php",
				method: "POST",
				data: {new_games: 1},
				success: (data, textStatus, jqXHR) => {
					if (!data["error"]){
						var newGames = data["games"];
						console.log(newGames);
						resolve(newGames);
					} else {
						console.log(data["error_message"]);
					}
				},
				error: (jqXHR, textStatus, errorThrown) => {
					console.log(errorThrown);
				},
				dataType: "json"
			});
		});

		class GameCard extends React.Component {
			render(){
				return (
						<div className="card border-primary" /* style={{height: "250px"}} */>
							<img className="card-img-top image-fluid d-block" src={this.props.thumbnail} alt={this.props.title}/>
							<div className="card-body" >
								<h5 className="card-title">{this.props.title}</h5>
							</div>
							<div className="card-footer text-center">
								<p className="card-text text-right" >{this.props.text}</p>
								<a className="btn btn-primary w-100" href="hellophaser.html">Play</a>
							</div>
						</div>
				);
			}	
		}

		class CarouselItemRow extends React.Component {

			renderGameCard(game) {
				return <GameCard thumbnail={game.thumbnail} title={game.name} text={game.subject} />;
			}

			//Four game-cards per carousel item
			render() {
				return (
					<div className={"carousel-item " + (this.props.first ? "active" : "")}>
						<div className="row">
							<div className="card-deck">
								{
									this.props.games.map((game) => {
										return this.renderGameCard(game);
									})
								}
							</div>
						</div>
					</div>
				);
			}
		}

		class Carousel extends React.Component {
			render() {
				var dividedGames = [];

				for (let i=0; i<this.props.games.length; i+=6){
					let t = [], n = 0;
					for (let j=0; j<6; j++){
						t.push(i+j+1>this.props.games.length ? 
							this.props.games[n++] : this.props.games[i+j]);
					}
					dividedGames.push(t);
				}

				return (
					<div id="newGamesCarousel" className="carousel slide" data-ride="carousel" data-interval="3000">
						<div className="container carousel-inner">
							{
								dividedGames.map((fourGames, n) => {
									return <CarouselItemRow games={fourGames} first={n==0 ? true : false}/>;
								})
							}
						</div>
					</div>
				);
			}

		}

		promise.then((games) => {
			console.log("Should now be rendering");
			ReactDOM.render (
				<Carousel games={games}/>,
				document.getElementById("newGames")
			);
		});
	</script>
	<script type="text/babel" src="js/catalog.js"></script>
		</body>
</html>